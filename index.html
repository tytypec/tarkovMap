<!DOCTYPE html>
<html>
    <head>
        <style>
            body{
            }
            #mainContainer{
                width: 100%;
                #position: absolute;
            
            }

            #contentContainer{
                border-style: solid;
                display: flex;
                flex-direction: row;
                #justify-content: space-around;
            }
            #myCanvas{
            position: absolute;
            border-style: solid;
            border-color: aquamarine;
            }
            img{
                width: 1920px;
                height: 998px;
                max-width: 100%;
                max-width: 100%
            }
            button{
                margin-top: 50px;
            }
            #sideBar{
                border-style: solid;
                border-color: red;
                display: flex;
                margin-left: 20px;
                flex-direction: column;
                line-height: .8;
                #justify-content: space-evenly;
            }

            .slideContainer{
                border-style: solid;


            }
        </style>
    </head>

    <body>
        <div id="mainContainer">
            <div class="topbar">
                hello
            </div>
            <div id="contentContainer">
                <canvas id="myCanvas" width=1920 height=998 style="cursor:crosshair"></canvas>
                <img src="\images\customsMap.PNG" alt="The map didn't load">
                <div id="sideBar">
                    <div class="slidecontainer">
                        <p>Circle size:</p>
                        <input type="range" min="6" max="80" value="40" class="slider" id="cirleSizeSlider">
                        <p>Value: <span id="circleSizeOutput">40</span></p>
                    </div>
                    <div class="slidecontainer">
                        <p>Circle color:</p>
                        <input type="range" min="1" max="222" value="222" class="slider" id="cirleColorSlider">
                        <p>Value: <span id="cirleColorOutput">222</span></p>
                    </div>
                    <div class="slidecontainer">
                        <p>Heat Sensativity:</p>
                        <input type="range" min="10" max="200" value="100" class="slider" id="heatSensitivitySlider">
                        <p>Value: <span id="heatSensitivityOutput">100</span></p>
                    </div>
                    <button onclick="reset()">Reset</button>
                </div>    
                
            </div>

        </div>
    

        <script>
            //var heatSize = 40;
            //var yellowValue = 222;
            var mapArea = document.getElementById('myCanvas');
            var context = mapArea.getContext('2d');
            var heatSizeSlider = document.getElementById("heatSizeSlider");
            var heatSizeSliderOutput = document.getElementById("circleSizeOutput");
            var circleColorSlider = document.getElementById("cirleColorSlider");
            var cirleColorOutput = document.getElementById("cirleColorOutput");
            var heatSensitivitySlider = document.getElementById("heatSensitivitySlider");
            var heatSensitivityOutput = document.getElementById("heatSensitivityOutput");
            var heatSize = parseInt(heatSizeSliderOutput.innerHTML);
            var yellowValue = parseInt(cirleColorOutput.innerHTML);
            
            //see  function colorShift() for heatSensitivity declaration
            //let heatSensitivity = 100
            
            //var smooch = document.getElementById("cirleSizeSlider").value;
            
            //try var blahblah = then the next line so you can use that to get the value of slider bar
            document.getElementById("cirleSizeSlider").oninput = function(){
                
                var slider = document.getElementById("cirleSizeSlider");
                var output = document.getElementById("circleSizeOutput");
                output.innerHTML = slider.value;

                slider.oninput = function() {
                output.innerHTML = this.value;
                }
                
            };

            document.getElementById("cirleColorSlider").oninput = function(){
                
                var slider = document.getElementById("cirleColorSlider");
                var output = document.getElementById("cirleColorOutput");
                output.innerHTML = slider.value;

                slider.oninput = function() {
                output.innerHTML = this.value;
                }
                
            };

            document.getElementById("heatSensitivitySlider").oninput = function(){
                
                var slider = document.getElementById("heatSensitivitySlider");
                var output = document.getElementById("heatSensitivityOutput");
                output.innerHTML = slider.value;

                slider.oninput = function() {
                output.innerHTML = this.value;
                }
                
            };
            

            function reset(){
                if (confirm('Are you sure you want to reset your map?')) {
                    localStorage.clear();
                    console.log("you clicked reset")
                    window.location.reload();
                } else {

                }

            }

        
            if(localStorage.getItem('textValues') == null){
            var locations=[];
            }
            else{
            locations =  JSON.parse(localStorage.getItem('textValues'));
            deathLocation("initialLoad");
            }


            
            
            function storeCooridnate(xValue, yValue, array, color, size){
                array.push({xValue, yValue, color, size});
                localStorage.setItem('textValues', JSON.stringify(array));
            }

                
            function printMousePos(event, canvas) {
                const rectangle = mapArea.getBoundingClientRect();
                storeCooridnate(event.clientX - rectangle.left, event.clientY - rectangle.top, locations, yellowValue, heatSize);
                console.log(locations);
                deathLocation("normal");
            }

            function deathLocation(type){



                    if (type === "initialLoad"){
                        locations.forEach(function(item,j){
                            var colorHolder = 'rgba(245, ' + locations[j].color + ', 0, 0.2)'
                            context.beginPath();
                            context.arc(locations[j].xValue, locations[j].yValue, locations[j].size, 0, 2 * Math.PI);
                            context.fillStyle = colorHolder;
                            context.stroke();
                            context.fill();
                        }
                    )
                    } 
                    else {
                        colorShift()
                        var colorHolder = 'rgba(245, ' + yellowValue + ', 0, 0.2)'
                        //context.fillText("x",locations[locations.length - 1].xValue, locations[locations.length - 1].yValue);
                        //context.font = "bold 30px Arial";
                        context.beginPath();
                        context.arc(locations[locations.length - 1].xValue, locations[locations.length - 1].yValue, heatSize, 0, 2 * Math.PI);
                        context.fillStyle = colorHolder;
                        context.stroke();
                        context.fill();
                    }
            }

            function colorShift(){
                    locations.forEach(function(item,i) {
                        var heatSensitivity =  parseInt(heatSensitivityOutput.innerHTML);
                        console.log(heatSensitivity);
                    let minimumXValue = (locations[i].xValue - heatSensitivity)
                    let maximumXValue = (locations[i].xValue + heatSensitivity)
                    let minimumYValue = (locations[i].yValue - heatSensitivity)
                    let maximumYValue = (locations[i].yValue + heatSensitivity)

                    function between(comparedNumber,min,max){
                    // console.log("here",comparedNumber, min, max);
                        return ((comparedNumber-min)*(comparedNumber-max) <= 0);   
                        //return comparedNumber >= min && comparedNumber <= max;
                        
                    }
                    //console.log(between(locations[locations.length - 1].xValue, minimumXValue, maximumXValue));
                        if (between(locations[locations.length - 1].xValue, minimumXValue, maximumXValue) && between(locations[locations.length - 1].yValue, minimumYValue, maximumYValue)){
                            //console.log(locations[locations.length - 1].xValue);
                            yellowValue = yellowValue - 60;
                            heatSize = heatSize + 4;
                        //console.log("inside function ", yellowValue);
                            return yellowValue;
                        } 
                        else {
                            //heatSize = 40;
                            //yellowValue = 222;
                            yellowValue = parseInt(cirleColorOutput.innerHTML);
                            heatSize = parseInt(heatSizeSliderOutput.innerHTML);
                        }
                    
                    });

            }

            myCanvas.addEventListener("click", printMousePos);
            

            

        </script>
    </body>
</html>